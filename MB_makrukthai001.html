<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Makruk Thai Master - ‡∏´‡∏°‡∏≤‡∏Å‡∏£‡∏∏‡∏Å‡πÑ‡∏ó‡∏¢‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --wood-dark: #3e2723;
            --wood-medium: #5d4037;
            --wood-light: #8d6e63;
            --gold: #fbbf24;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
        }

        h1, h2, h3, .font-kanit {
            font-family: 'Kanit', sans-serif;
        }

        .hero-gradient {
            background: linear-gradient(135deg, #1a1a1a 0%, #2c1810 100%);
        }

        /* Board Styling */
        .board-container {
            width: 100%;
            max-width: 520px;
            margin: 0 auto;
            perspective: 1000px;
        }

        .board-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            width: 100%;
            aspect-ratio: 1 / 1;
            border: 10px solid var(--wood-dark);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            background-color: var(--wood-dark);
        }

        .square {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.1s ease;
        }

        .square.light { background-color: #d7ccc8; }
        .square.dark { background-color: #a1887f; }
        .square.selected { background-color: #fff176 !important; box-shadow: inset 0 0 15px rgba(0,0,0,0.2); }
        .square.last-move { background-color: rgba(255, 255, 255, 0.35) !important; }
        
        .square.highlight::after {
            content: '';
            width: 30%;
            height: 30%;
            background-color: rgba(34, 197, 94, 0.5);
            border-radius: 50%;
            position: absolute;
        }

        .piece {
            width: 85%;
            height: 85%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.5rem, 6vw, 2.6rem);
            z-index: 10;
            user-select: none;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.3));
        }

        .piece:hover { transform: scale(1.15); }
        .piece.black { color: #1a1a1a; filter: drop-shadow(0 0 1px #fff) drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        .piece.white { color: #ffffff; filter: drop-shadow(0 0 2px #000); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: var(--wood-medium); border-radius: 10px; }

        .ai-thinking-pulse {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.98); }
            100% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-stone-950">

    <!-- Navigation -->
    <nav class="border-b border-white/10 bg-black/50 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üëë</span>
                <span class="text-xl font-bold font-kanit tracking-tighter text-amber-500">MAKRUK MASTER</span>
            </div>
            <div class="hidden md:flex gap-6 text-sm font-medium text-gray-400">
                <a href="#play" class="hover:text-amber-500 transition">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</a>
                <a href="#rules" class="hover:text-amber-500 transition">‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤</a>
                <a href="#about" class="hover:text-amber-500 transition">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö</a>
            </div>
            <button onclick="document.getElementById('play').scrollIntoView({behavior:'smooth'})" class="bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-full text-sm font-bold transition">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢</button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-gradient py-12 md:py-20 px-4 border-b border-white/5">
        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
            <div>
                <span class="bg-amber-500/10 text-amber-500 border border-amber-500/20 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-widest mb-4 inline-block">Thai Traditional Game</span>
                <h2 class="text-5xl md:text-7xl font-bold font-kanit leading-tight mb-6">‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏õ‡∏±‡∏ç‡∏ç‡∏≤<br><span class="text-amber-500">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô</span></h2>
                <p class="text-lg text-gray-400 mb-8 max-w-lg">‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏´‡∏°‡∏≤‡∏Å‡∏£‡∏∏‡∏Å‡πÑ‡∏ó‡∏¢‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏•‡∏≠‡∏á‡∏ù‡∏µ‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</p>
                <div class="flex flex-wrap gap-4">
                    <button onclick="document.getElementById('play').scrollIntoView({behavior:'smooth'})" class="bg-amber-600 hover:bg-amber-500 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg shadow-amber-900/20 transition transform hover:-translate-y-1">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ</button>
                    <button onclick="document.getElementById('rules').scrollIntoView({behavior:'smooth'})" class="bg-white/5 hover:bg-white/10 text-white border border-white/10 px-8 py-4 rounded-xl font-bold text-lg transition">‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤</button>
                </div>
            </div>
            <div class="relative group">
                <div class="absolute -inset-1 bg-gradient-to-r from-amber-600 to-yellow-400 rounded-2xl blur opacity-25 group-hover:opacity-40 transition duration-1000"></div>
                <div class="relative bg-stone-900 border border-white/10 p-4 rounded-2xl">
                    <img src="https://images.unsplash.com/photo-1586165368502-1bad197a6461?q=80&w=800&auto=format&fit=crop" alt="Chess Board" class="rounded-xl grayscale hover:grayscale-0 transition duration-700 w-full h-auto">
                </div>
            </div>
        </div>
    </section>

    <!-- Game Section -->
    <section id="play" class="py-16 px-4">
        <div class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <!-- Game Sidebar -->
                <div class="lg:col-span-3 space-y-6 order-2 lg:order-1">
                    <div class="bg-stone-900 p-6 rounded-2xl border border-white/5 shadow-xl">
                        <h3 class="text-xl font-bold mb-4 text-amber-500 font-kanit">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="text-[10px] text-gray-500 uppercase font-bold tracking-widest block mb-2">‡πÇ‡∏´‡∏°‡∏î</label>
                                <select id="gameMode" class="w-full bg-stone-800 border border-white/10 rounded-xl p-3 text-sm focus:ring-2 focus:ring-amber-500 outline-none transition">
                                    <option value="pve">‡∏™‡∏π‡πâ‡∏Å‡∏±‡∏ö AI (Single Player)</option>
                                    <option value="pvp">‡∏™‡∏π‡πâ‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô (Local PvP)</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] text-gray-500 uppercase font-bold tracking-widest block mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö AI</label>
                                <select id="aiLevel" class="w-full bg-stone-800 border border-white/10 rounded-xl p-3 text-sm focus:ring-2 focus:ring-amber-500 outline-none transition">
                                    <option value="1">‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà (Random)</option>
                                    <option value="2">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (Greedy)</option>
                                    <option value="3" selected>‡∏õ‡∏£‡∏°‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå (Deep Search)</option>
                                </select>
                            </div>
                            <button id="resetBtn" class="w-full bg-stone-800 hover:bg-red-900/30 text-red-500 border border-red-500/20 py-3 rounded-xl font-bold text-sm transition mt-2">
                                ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô
                            </button>
                        </div>
                    </div>

                    <div class="bg-stone-900 p-6 rounded-2xl border border-white/5 shadow-xl">
                        <h3 class="text-xl font-bold mb-4 text-amber-500 font-kanit">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô</h3>
                        <div id="moveLog" class="h-48 overflow-y-auto bg-black/30 rounded-xl p-4 text-[11px] font-mono text-gray-400 space-y-1">
                            <div>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô...</div>
                        </div>
                    </div>
                </div>

                <!-- Game Board -->
                <div class="lg:col-span-6 flex flex-col items-center order-1 lg:order-2">
                    <div id="statusDisplay" class="mb-6 px-8 py-3 bg-amber-500/10 border border-amber-500/20 rounded-full text-amber-500 font-bold text-lg shadow-lg ai-thinking-pulse">
                        ‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏ß
                    </div>
                    
                    <div class="board-container">
                        <div id="board" class="board-grid rounded-lg overflow-hidden">
                            <!-- JS Generator -->
                        </div>
                    </div>

                    <div id="ai-thinking" class="mt-4 text-cyan-400 font-mono text-sm hidden">
                        <span class="inline-block w-2 h-2 bg-cyan-400 rounded-full animate-ping mr-2"></span>
                        AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ...
                    </div>
                </div>

                <!-- Score & Info -->
                <div class="lg:col-span-3 space-y-6 order-3">
                    <div class="bg-stone-900 p-6 rounded-2xl border border-white/5 shadow-xl">
                        <h3 class="text-xl font-bold mb-4 text-amber-500 font-kanit">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üêö</span>
                                    <span class="font-bold">‡∏Ç‡∏≤‡∏ß</span>
                                </div>
                                <span id="whiteScore" class="font-mono text-xl text-amber-500">0</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üåë</span>
                                    <span class="font-bold">‡∏î‡∏≥</span>
                                </div>
                                <span id="blackScore" class="font-mono text-xl text-gray-400">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-amber-600/10 p-6 rounded-2xl border border-amber-600/20">
                        <h4 class="font-bold text-amber-500 mb-2 font-kanit text-sm">‡πÄ‡∏Å‡∏£‡πá‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ:</h4>
                        <p class="text-xs text-gray-400 leading-relaxed">"‡∏´‡∏°‡∏≤‡∏Å‡∏£‡∏∏‡∏Å‡πÑ‡∏ó‡∏¢" ‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡πÅ‡∏ô‡πà‡∏ô ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏°‡∏≤‡∏Å‡∏£‡∏∏‡∏Å‡∏™‡∏≤‡∏Å‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏π‡πà‡πÇ‡∏à‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</p>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Rules Section -->
    <section id="rules" class="py-20 bg-stone-900/50 px-4">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-4xl font-bold font-kanit text-center mb-12">‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="flex gap-4 items-start">
                    <div class="bg-amber-500 text-black w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold">1</div>
                    <div>
                        <h4 class="font-bold mb-1 text-lg">‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ (Bia)</h4>
                        <p class="text-sm text-gray-400">‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á 1 ‡∏ä‡πà‡∏≠‡∏á ‡∏Å‡∏¥‡∏ô‡∏ó‡∏∞‡πÅ‡∏¢‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 6 ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏´‡∏á‡∏≤‡∏¢"</p>
                    </div>
                </div>
                <div class="flex gap-4 items-start">
                    <div class="bg-amber-500 text-black w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold">2</div>
                    <div>
                        <h4 class="font-bold mb-1 text-lg">‡πÇ‡∏Ñ‡∏ô (Khon)</h4>
                        <p class="text-sm text-gray-400">‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏î‡πâ 5 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á: ‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á ‡πÅ‡∏•‡∏∞‡∏ó‡∏∞‡πÅ‡∏¢‡∏á‡∏ó‡∏±‡πâ‡∏á 4 ‡∏°‡∏∏‡∏° (‡∏´‡∏ô‡πâ‡∏≤-‡∏´‡∏•‡∏±‡∏á)</p>
                    </div>
                </div>
                <div class="flex gap-4 items-start">
                    <div class="bg-amber-500 text-black w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold">3</div>
                    <div>
                        <h4 class="font-bold mb-1 text-lg">‡πÄ‡∏°‡πá‡∏î (Met)</h4>
                        <p class="text-sm text-gray-400">‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏î‡πâ 4 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏∞‡πÅ‡∏¢‡∏á‡∏°‡∏∏‡∏°‡∏•‡∏∞ 1 ‡∏ä‡πà‡∏≠‡∏á</p>
                    </div>
                </div>
                <div class="flex gap-4 items-start">
                    <div class="bg-amber-500 text-black w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold">4</div>
                    <div>
                        <h4 class="font-bold mb-1 text-lg">‡∏Ç‡∏∏‡∏ô (Khun)</h4>
                        <p class="text-sm text-gray-400">‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏ó‡∏±‡πâ‡∏á 8 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á ‡∏ó‡∏¥‡∏®‡∏•‡∏∞ 1 ‡∏ä‡πà‡∏≠‡∏á ‡∏´‡∏≤‡∏Å‡∏Ç‡∏∏‡∏ô‡∏ñ‡∏π‡∏Å‡∏Å‡∏¥‡∏ô‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏à‡∏ö‡πÄ‡∏Å‡∏°</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 border-t border-white/5 text-center text-gray-500 text-xs">
        <p class="mb-2">¬© 2024 Makruk Master Digital. All Rights Reserved.</p>
        <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏™‡∏∑‡∏ö‡∏™‡∏≤‡∏ô‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏´‡∏°‡∏≤‡∏Å‡∏£‡∏∏‡∏Å‡πÑ‡∏ó‡∏¢</p>
    </footer>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="fixed inset-0 bg-black/95 hidden flex items-center justify-center z-[100] p-4">
        <div class="bg-stone-900 border border-amber-500/30 p-12 rounded-[40px] max-w-sm w-full text-center shadow-[0_0_100px_rgba(245,158,11,0.15)]">
            <div class="text-8xl mb-6 transform animate-bounce" id="winnerEmoji">üèÜ</div>
            <h2 class="text-4xl font-bold text-amber-500 mb-2 font-kanit" id="winnerMsg">‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß!</h2>
            <p class="text-gray-400 mb-10" id="winDetail">‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏õ‡∏£‡∏°‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</p>
            <button onclick="location.reload()" class="w-full bg-amber-600 hover:bg-amber-500 text-white py-4 rounded-2xl font-bold text-lg shadow-xl transition active:scale-95">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà</button>
        </div>
    </div>

    <script>
        // --- GAME ENGINE ---
        const WHITE = 'white', BLACK = 'black';
        const KHUN = 'khun', MET = 'met', KHON = 'khon', MA = 'ma', RUA = 'rua', BIA = 'bia', BIA_NGAI = 'bia_ngai';

        const PIECE_VALUES = { [KHUN]: 10000, [RUA]: 800, [MA]: 350, [KHON]: 300, [MET]: 150, [BIA_NGAI]: 150, [BIA]: 50 };
        const PIECE_ICONS = {
            [WHITE]: { [KHUN]: 'üëë', [MET]: 'üîπ', [KHON]: 'üõ°Ô∏è', [MA]: 'üê¥', [RUA]: 'üõ∂', [BIA]: 'üêö', [BIA_NGAI]: '‚ú®' },
            [BLACK]: { [KHUN]: '‚ôö', [MET]: '‚óÜ', [KHON]: '‚ôú', [MA]: '‚ôû', [RUA]: 'üö¢', [BIA]: 'üåë', [BIA_NGAI]: 'üîÜ' }
        };

        let gameState = {
            board: [],
            turn: WHITE,
            selectedSquare: null,
            validMoves: [],
            gameActive: true,
            mode: 'pve',
            aiLevel: 3,
            lastMove: null
        };

        function initBoard() {
            const b = Array(8).fill(null).map(() => Array(8).fill(null));
            const setup = (row, color, isPawn) => {
                if(isPawn) { for(let i=0; i<8; i++) b[row][i] = { type: BIA, color }; return; }
                const line = [RUA, MA, KHON, color===WHITE?KHUN:MET, color===WHITE?MET:KHUN, KHON, MA, RUA];
                line.forEach((t, i) => b[row][i] = { type: t, color });
            };
            setup(0, BLACK); setup(2, BLACK, true);
            setup(7, WHITE); setup(5, WHITE, true);
            return b;
        }

        function getValidMoves(r, c, board) {
            const p = board[r][c]; if(!p) return [];
            const moves = [];
            const onBoard = (nr, nc) => nr>=0 && nr<8 && nc>=0 && nc<8;
            const canGo = (nr, nc) => onBoard(nr,nc) && (!board[nr][nc] || board[nr][nc].color !== p.color);
            const add = (nr, nc) => { if(canGo(nr,nc)) moves.push({r:nr, c:nc}); };

            if(p.type === KHUN) { for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++) if(dr||dc) add(r+dr, c+dc); }
            else if(p.type === MET || p.type === BIA_NGAI) { [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(([dr,dc])=>add(r+dr,c+dc)); }
            else if(p.type === KHON) {
                const f = p.color === WHITE ? -1 : 1;
                [[f,0],[f,-1],[f,1],[-f,-1],[-f,1]].forEach(([dr,dc])=>add(r+dr,c+dc));
            } else if(p.type === MA) {
                [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc])=>add(r+dr,c+dc));
            } else if(p.type === RUA) {
                [[0,1],[0,-1],[1,0],[-1,0]].forEach(([dr,dc])=>{
                    let nr=r+dr, nc=c+dc;
                    while(onBoard(nr,nc)){
                        if(!board[nr][nc]) moves.push({r:nr, c:nc});
                        else { if(board[nr][nc].color !== p.color) moves.push({r:nr, c:nc}); break; }
                        nr+=dr; nc+=dc;
                    }
                });
            } else if(p.type === BIA) {
                const s = p.color === WHITE ? -1 : 1;
                if(onBoard(r+s, c) && !board[r+s][c]) moves.push({r:r+s, c:c});
                [-1,1].forEach(dc => { if(onBoard(r+s,c+dc) && board[r+s][c+dc] && board[r+s][c+dc].color !== p.color) moves.push({r:r+s, c:c+dc}); });
            }
            return moves;
        }

        // --- AI LOGIC ---
        function evaluate(board) {
            let s = 0;
            for(let r=0;r<8;r++) for(let c=0;c<8;c++) {
                const p = board[r][c]; if(!p) continue;
                let v = PIECE_VALUES[p.type];
                if(p.type === BIA) v += (p.color === WHITE ? (7-r) : r) * 5;
                if(p.type === MA || p.type === KHON) v += (7 - (Math.abs(3.5-r)+Math.abs(3.5-c))) * 8;
                s += (p.color === BLACK ? v : -v);
            }
            return s;
        }

        function minimax(board, depth, alpha, beta, isMax) {
            if(depth === 0) return evaluate(board);
            const moves = [];
            for(let r=0;r<8;r++) for(let c=0;c<8;c++) {
                const p = board[r][c];
                if(p && p.color === (isMax?BLACK:WHITE)) getValidMoves(r,c,board).forEach(m=>moves.push({f:{r,c}, t:m}));
            }
            if(moves.length === 0) return isMax?-9999:9999;

            if(isMax) {
                let best = -Infinity;
                for(let m of moves) {
                    const next = clone(board); doMove(next, m.f, m.t);
                    const v = minimax(next, depth-1, alpha, beta, false);
                    best = Math.max(best, v); alpha = Math.max(alpha, v);
                    if(beta <= alpha) break;
                }
                return best;
            } else {
                let best = Infinity;
                for(let m of moves) {
                    const next = clone(board); doMove(next, m.f, m.t);
                    const v = minimax(next, depth-1, alpha, beta, true);
                    best = Math.min(best, v); beta = Math.min(beta, v);
                    if(beta <= alpha) break;
                }
                return best;
            }
        }

        function clone(b) { return b.map(row=>row.map(c=>c?{...c}:null)); }
        function doMove(b, f, t) {
            const p = b[f.r][f.c]; b[t.r][t.c] = p; b[f.r][f.c] = null;
            if(p.type === BIA) {
                if(p.color === WHITE && t.r === 2) p.type = BIA_NGAI;
                if(p.color === BLACK && t.r === 5) p.type = BIA_NGAI;
            }
        }

        function triggerAI() {
            const thinking = document.getElementById('ai-thinking');
            thinking.classList.remove('hidden');
            setTimeout(() => {
                const moves = [];
                for(let r=0;r<8;r++) for(let c=0;c<8;c++) {
                    const p = gameState.board[r][c];
                    if(p && p.color === BLACK) getValidMoves(r,c,gameState.board).forEach(m=>moves.push({f:{r,c}, t:m}));
                }
                if(moves.length === 0) return;

                let bestM = null, bestV = -Infinity, depth = parseInt(gameState.aiLevel);
                if(depth === 1) bestM = moves[Math.floor(Math.random()*moves.length)];
                else {
                    for(let m of moves) {
                        const next = clone(gameState.board); doMove(next, m.f, m.t);
                        const v = minimax(next, depth===2?1:3, -Infinity, Infinity, false);
                        if(v > bestV) { bestV = v; bestM = m; }
                    }
                }
                thinking.classList.add('hidden');
                if(bestM) execMove(bestM.f.r, bestM.f.c, bestM.t.r, bestM.t.c);
            }, 500);
        }

        // --- UI ---
        function updateScores() {
            let wS = 0, bS = 0;
            for(let r=0;r<8;r++) for(let c=0;c<8;c++) {
                const p = gameState.board[r][c]; if(!p) continue;
                if(p.color === WHITE) wS += PIECE_VALUES[p.type]; else bS += PIECE_VALUES[p.type];
            }
            document.getElementById('whiteScore').textContent = wS;
            document.getElementById('blackScore').textContent = bS;
        }

        function render() {
            const bEl = document.getElementById('board'); bEl.innerHTML = '';
            for(let r=0;r<8;r++) for(let c=0;c<8;c++) {
                const sq = document.createElement('div');
                sq.className = `square ${(r+c)%2===0?'light':'dark'}`;
                if(gameState.selectedSquare?.r===r && gameState.selectedSquare?.c===c) sq.classList.add('selected');
                if(gameState.lastMove && ((gameState.lastMove.f.r===r && gameState.lastMove.f.c===c) || (gameState.lastMove.t.r===r && gameState.lastMove.t.c===c))) sq.classList.add('last-move');
                if(gameState.validMoves.some(m=>m.r===r && m.c===c)) sq.classList.add('highlight');

                const p = gameState.board[r][c];
                if(p) {
                    const pEl = document.createElement('div');
                    pEl.className = `piece ${p.color}`;
                    pEl.textContent = PIECE_ICONS[p.color][p.type];
                    sq.appendChild(pEl);
                }
                sq.onclick = () => {
                    if(!gameState.gameActive || (gameState.mode==='pve' && gameState.turn===BLACK)) return;
                    if(p && p.color === gameState.turn) {
                        gameState.selectedSquare = {r,c};
                        gameState.validMoves = getValidMoves(r,c,gameState.board);
                    } else if(gameState.selectedSquare) {
                        const m = gameState.validMoves.find(mv=>mv.r===r && mv.c===c);
                        if(m) execMove(gameState.selectedSquare.r, gameState.selectedSquare.c, r, c);
                        else { gameState.selectedSquare = null; gameState.validMoves = []; }
                    }
                    render();
                };
                bEl.appendChild(sq);
            }
            const s = document.getElementById('statusDisplay');
            s.textContent = `‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏ù‡πà‡∏≤‡∏¢${gameState.turn===WHITE?'‡∏Ç‡∏≤‡∏ß':'‡∏î‡∏≥'}`;
            updateScores();
        }

        function execMove(fr, fc, tr, tc) {
            const target = gameState.board[tr][tc];
            if(target && target.type === KHUN) return win(gameState.turn);
            
            gameState.lastMove = { f:{r:fr,c:fc}, t:{r:tr,c:tc} };
            doMove(gameState.board, gameState.lastMove.f, gameState.lastMove.t);
            
            const log = document.getElementById('moveLog');
            const entry = document.createElement('div');
            entry.textContent = `${gameState.turn==WHITE?'‡∏Ç‡∏≤‡∏ß':'‡∏î‡∏≥'}: ${fr},${fc} ‡πÑ‡∏õ ${tr},${tc}`;
            log.prepend(entry);

            gameState.selectedSquare = null; gameState.validMoves = [];
            gameState.turn = gameState.turn === WHITE ? BLACK : WHITE;
            render();

            let wK=0, bK=0;
            for(let row of gameState.board) for(let p of row) if(p?.type===KHUN) p.color===WHITE?wK++:bK++;
            if(!wK) return win(BLACK); if(!bK) return win(WHITE);

            if(gameState.mode==='pve' && gameState.turn===BLACK && gameState.gameActive) triggerAI();
        }

        function win(w) {
            gameState.gameActive = false;
            document.getElementById('gameOverModal').classList.remove('hidden');
            document.getElementById('winnerMsg').textContent = (w === WHITE ? '‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞!' : 'AI ‡∏ä‡∏ô‡∏∞!');
            document.getElementById('winnerEmoji').textContent = (w === WHITE ? 'üèÜ' : 'ü§ñ');
        }

        document.getElementById('resetBtn').onclick = () => location.reload();
        document.getElementById('gameMode').onchange = (e) => gameState.mode = e.target.value;
        document.getElementById('aiLevel').onchange = (e) => gameState.aiLevel = e.target.value;

        gameState.board = initBoard();
        render();
    </script>
</body>
</html>